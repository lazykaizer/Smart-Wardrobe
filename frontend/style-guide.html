<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics - Smart Wardrobe</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="users.js"></script>
    <script>
        // Check if user is logged in
        document.addEventListener('DOMContentLoaded', function() {
            if (!userDB.isLoggedIn()) {
                window.location.href = 'login.html';
            }
        });
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: #0f172a;
            color: #e2e8f0;
            line-height: 1.5;
        }

        .main-content {
            margin-left: 280px;
            padding: 0;
            min-height: 100vh;
        }

        .analytics-container {
            padding: 24px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .page-header {
            margin-bottom: 24px;
        }

        .page-title {
            font-size: 24px;
            font-weight: 700;
            color: #f8fafc;
            margin-bottom: 4px;
        }

        .page-subtitle {
            font-size: 14px;
            color: #94a3b8;
            font-weight: 400;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-bottom: 24px;
        }

        .left-column {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .right-column {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .metric-card {
            background: #1e293b;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            border: 1px solid #334155;
        }

        .metric-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .metric-title {
            font-size: 12px;
            font-weight: 500;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .metric-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            color: white;
        }

        .metric-icon.blue { background: #3b82f6; }
        .metric-icon.green { background: #10b981; }
        .metric-icon.purple { background: #8b5cf6; }
        .metric-icon.orange { background: #f59e0b; }

        .metric-value {
            font-size: 28px;
            font-weight: 700;
            color: #f8fafc;
            margin-bottom: 8px;
        }

        .metric-change {
            display: flex;
            align-items: center;
            font-size: 12px;
            font-weight: 500;
        }

        .metric-change.positive {
            color: #10b981;
        }

        .metric-change.negative {
            color: #ef4444;
        }

        .metric-change.neutral {
            color: #94a3b8;
        }

        .change-icon {
            margin-right: 4px;
            font-size: 10px;
        }

        .chart-card {
            background: #1e293b;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            border: 1px solid #334155;
        }

        .chart-header {
            margin-bottom: 20px;
        }

        .chart-title {
            font-size: 16px;
            font-weight: 600;
            color: #f8fafc;
            margin-bottom: 4px;
        }

        .chart-subtitle {
            font-size: 12px;
            color: #94a3b8;
        }

        .chart-container {
            height: 200px;
            position: relative;
        }

        .chart-container.large {
            height: 300px;
        }

        .insights-card {
            background: #1e293b;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            border: 1px solid #334155;
        }

        .insight-item {
            display: flex;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #334155;
        }

        .insight-item:last-child {
            border-bottom: none;
        }

        .insight-icon {
            width: 24px;
            height: 24px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            margin-right: 12px;
            color: white;
        }

        .insight-icon.success { background: #10b981; }
        .insight-icon.warning { background: #f59e0b; }
        .insight-icon.info { background: #3b82f6; }

        .insight-content {
            flex: 1;
        }

        .insight-title {
            font-size: 13px;
            font-weight: 500;
            color: #f8fafc;
            margin-bottom: 2px;
        }

        .insight-description {
            font-size: 11px;
            color: #94a3b8;
        }

        .recommendations-card {
            background: #1e293b;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            border: 1px solid #334155;
        }

        .recommendation-item {
            background: #334155;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
            border-left: 3px solid #3b82f6;
        }

        .recommendation-item:last-child {
            margin-bottom: 0;
        }

        .rec-title {
            font-size: 12px;
            font-weight: 600;
            color: #f8fafc;
            margin-bottom: 4px;
        }

        .rec-description {
            font-size: 11px;
            color: #94a3b8;
            line-height: 1.4;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #334155;
            border-radius: 3px;
            overflow: hidden;
            margin-top: 8px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6);
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #94a3b8;
        }

        .empty-icon {
            font-size: 32px;
            margin-bottom: 12px;
            opacity: 0.5;
        }

        .empty-title {
            font-size: 14px;
            font-weight: 600;
            color: #f8fafc;
            margin-bottom: 4px;
        }

        .empty-description {
            font-size: 12px;
            line-height: 1.4;
        }

        .stats-row {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        @media (max-width: 768px) {
            .main-content {
                margin-left: 0;
            }
            
            .analytics-container {
                padding: 16px;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-row {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <aside class="app-sidebar">
        <div class="app-header">
            <img src="assets/logo.png" alt="Logo"/>
            <h1 class="app-title">Smart Wardrobe</h1>
        </div>
        <nav class="app-nav" data-active="3">
            <div class="nav-glider-container">
                <div class="nav-glider"></div>
            </div>
            <a href="index.html" class="nav-link">
                <i class="fas fa-home"></i><span class="nav-link-text">Dashboard</span>
            </a>
            <a href="wardrobe.html" class="nav-link">
                <i class="fas fa-tshirt"></i><span class="nav-link-text">My Wardrobe</span>
            </a>
            <a href="ai-stylist.html" class="nav-link">
                <i class="fas fa-robot"></i><span class="nav-link-text">AI Outfits</span>
            </a>
            <a href="style-guide.html" class="nav-link active">
                <i class="fas fa-chart-bar"></i><span class="nav-link-text">Analytics</span>
            </a>
            <a href="ai-cloth-changer.html" class="nav-link">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m21 16-4 4-4-4"></path><path d="M17 20V4"></path><path d="m3 8 4-4 4 4"></path><path d="M7 4v16"></path></svg><span class="nav-link-text">AI Cloth Changer</span>
            </a>
        </nav>
        <div class="app-bottom">
            <button id="sidebar-toggle" class="btn-sidebar-toggle" onclick="toggleSidebar()">
                <div class="button-outer">
                    <div class="button-inner"></div>
                </div>
            </button>
        </div>
    </aside>

    <div class="app-content">
        <header class="app-topbar">
            <button class="settings-btn" id="settings-btn-main">
                <i class="fas fa-cog"></i>
                <span>Settings</span>
            </button>
            <button class="logout-btn" id="logout-btn-main">
                <i class="fas fa-sign-out-alt"></i>
                <span>Logout</span>
            </button>
        </header>

        <main class="main-content">
            <style>
                /* Topbar styles */
                .app-topbar {
                    display: flex;
                    justify-content: flex-end;
                    align-items: center;
                    padding: 20px 32px;
                    background: rgba(255, 255, 255, 0.05);
                    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
                }
                
                .settings-btn {
                    background: linear-gradient(135deg, #a855f7, #7c3aed);
                    color: white;
                    border: none;
                    padding: 12px 20px;
                    border-radius: 8px;
                    font-weight: 600;
                    cursor: pointer;
                    transition: all 0.3s ease;
                    display: flex;
                    align-items: center;
                    gap: 8px;
                    margin-right: 12px;
                }

                .settings-btn:hover {
                    transform: translateY(-2px);
                    box-shadow: 0 8px 20px rgba(168, 85, 247, 0.3);
                }
                
                .logout-btn {
                    background: linear-gradient(135deg, #ef4444, #dc2626);
                    color: white;
                    border: none;
                    padding: 10px 20px;
                    border-radius: 8px;
                    cursor: pointer;
                    font-size: 0.9em;
                    font-weight: 500;
                    display: flex;
                    align-items: center;
                    gap: 8px;
                    transition: all 0.3s ease;
                    margin-left: 12px;
                }
                
                .logout-btn:hover {
                    transform: translateY(-2px);
                    box-shadow: 0 8px 25px rgba(239, 68, 68, 0.4);
                }
                
                .refresh-btn {
                    background: linear-gradient(135deg, #06b6d4, #0891b2);
                    color: white;
                    border: none;
                    padding: 8px 16px;
                    border-radius: 6px;
                    cursor: pointer;
                    font-size: 0.85em;
                    font-weight: 500;
                    display: flex;
                    align-items: center;
                    gap: 6px;
                    transition: all 0.3s ease;
                    margin-left: auto;
                }
                
                .refresh-btn:hover {
                    transform: translateY(-1px);
                    box-shadow: 0 4px 12px rgba(6, 182, 212, 0.4);
                }
                
                .page-header {
                    display: flex;
                    align-items: center;
                    gap: 16px;
                    margin-bottom: 24px;
                }
            </style>
            
            <div class="analytics-container">
            <div class="page-header">
                <h1 class="page-title">Analytics</h1>
                <p class="page-subtitle">Track your wardrobe usage and style insights</p>
                <button class="refresh-btn" onclick="refreshAnalytics()" title="Refresh data">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
            </div>

            <div id="analyticsContent">
                <!-- Content will be loaded dynamically -->
            </div>
        </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            loadAnalytics();
            
            // Simple sidebar toggle function
            window.toggleSidebar = function() {
                document.body.classList.toggle('sidebar-collapsed');
                const isCollapsed = document.body.classList.contains('sidebar-collapsed');
                const label = document.querySelector('.label');
                const icon = document.querySelector('.fa-chevron-left');
                
                if (label) label.textContent = isCollapsed ? 'Expand' : 'Collapse';
                if (icon) icon.classList.toggle('fa-rotate-180', isCollapsed);
                
                localStorage.setItem('sidebarCollapsed', isCollapsed);
            };
            
            // Logout functionality
            document.getElementById('logout-btn-main').addEventListener('click', function() {
                if (confirm('Are you sure you want to logout?')) {
                    userDB.logoutUser();
                    sessionStorage.clear();
                    localStorage.removeItem('isLoggedIn');
                    window.location.href = 'landing.html';
                }
            });

            // Settings functionality
            document.getElementById('settings-btn-main').addEventListener('click', function() {
                window.location.href = 'settings.html';
            });
            
            // Auto-refresh analytics when page becomes visible
            document.addEventListener('visibilitychange', function() {
                if (!document.hidden) {
                    console.log('Page became visible, refreshing analytics...');
                    refreshAnalytics();
                }
            });
            
            // Auto-refresh every 30 seconds
            setInterval(function() {
                console.log('Auto-refreshing analytics...');
                refreshAnalytics();
            }, 30000);
        });

        // Add function to track outfit usage (call this when user wears an outfit)
        function trackOutfitUsage(outfitItems, score = 85) {
            const wornEntry = {
                date: new Date().toISOString().split('T')[0],
                outfit: outfitItems,
                score: score,
                timestamp: Date.now()
            };
            
            let wornHistory = userDB.loadUserData('wornHistory', []);
            wornHistory.push(wornEntry);
            
            // Keep only last 30 days of history
            const thirtyDaysAgo = Date.now() - (30 * 24 * 60 * 60 * 1000);
            wornHistory = wornHistory.filter(entry => entry.timestamp > thirtyDaysAgo);
            
            userDB.saveUserData('wornHistory', wornHistory);
            console.log('Tracked outfit usage:', wornEntry);
        }

        // Function to refresh analytics data
        function refreshAnalytics() {
            loadAnalytics();
        }

        function loadAnalytics() {
            try {
                // Load real wardrobe data using userDB
                let wardrobeItems = userDB.loadUserData('wardrobeItems', []);
                
                // Load worn history (outfit usage data)
                let wornHistory = userDB.loadUserData('wornHistory', []);
                
                // Load saved outfits for additional analytics
                let savedOutfits = userDB.loadUserData('savedOutfits', []);
                
                // Load calendar events for context
                let calendarEvents = userDB.loadUserData('calendarEvents', []);
                
                console.log('Analytics - Loaded wardrobe items:', wardrobeItems.length);
                console.log('Analytics - Loaded worn history:', wornHistory.length);
                console.log('Analytics - Loaded saved outfits:', savedOutfits.length);
                console.log('Analytics - Loaded calendar events:', calendarEvents.length);
                
                // If no real data, show empty state instead of sample data
                if (wardrobeItems.length === 0) {
                    showEmptyState();
                    return;
                }
                
                renderAnalytics(wardrobeItems, wornHistory, savedOutfits, calendarEvents);
                
            } catch (error) {
                console.error('Error loading analytics:', error);
                showEmptyState();
            }
        }

        function generateSampleWardrobeData() {
            // Generate sample data to show your actual wardrobe size
            const sampleItems = [
                { name: 'Black T-shirt', category: 'topwear', color: 'black' },
                { name: 'White T-shirt', category: 'topwear', color: 'white' },
                { name: 'Blue Jeans', category: 'bottomwear', color: 'blue' },
                { name: 'Black Jeans', category: 'bottomwear', color: 'black' },
                { name: 'White Sneakers', category: 'footwear', color: 'white' },
                { name: 'Black Sneakers', category: 'footwear', color: 'black' },
                { name: 'Red Hoodie', category: 'topwear', color: 'red' },
                { name: 'Navy Blue Shirt', category: 'topwear', color: 'navy' },
                { name: 'Gray Sweater', category: 'topwear', color: 'gray' },
                { name: 'Brown Leather Jacket', category: 'outerwear', color: 'brown' },
                { name: 'Black Dress Pants', category: 'bottomwear', color: 'black' },
                { name: 'White Dress Shirt', category: 'topwear', color: 'white' },
                { name: 'Green Cargo Pants', category: 'bottomwear', color: 'green' },
                { name: 'Yellow T-shirt', category: 'topwear', color: 'yellow' },
                { name: 'Purple Hoodie', category: 'topwear', color: 'purple' },
                { name: 'Black Boots', category: 'footwear', color: 'black' },
                { name: 'White Canvas Shoes', category: 'footwear', color: 'white' },
                { name: 'Blue Shorts', category: 'bottomwear', color: 'blue' },
                { name: 'Pink Blouse', category: 'topwear', color: 'pink' },
                { name: 'Black Leather Belt', category: 'accessories', color: 'black' },
                { name: 'Silver Watch', category: 'accessories', color: 'silver' },
                { name: 'Blue Denim Jacket', category: 'outerwear', color: 'blue' },
                { name: 'White Polo Shirt', category: 'topwear', color: 'white' },
                { name: 'Black Chinos', category: 'bottomwear', color: 'black' },
                { name: 'Brown Loafers', category: 'footwear', color: 'brown' },
                { name: 'Gray Cardigan', category: 'topwear', color: 'gray' },
                { name: 'Black Dress Shoes', category: 'footwear', color: 'black' },
                { name: 'White Tank Top', category: 'topwear', color: 'white' }
            ];
            
            return sampleItems;
        }

        function showEmptyState() {
            document.getElementById('analyticsContent').innerHTML = `
                <div class="empty-state">
                    <div class="empty-icon">ðŸ“Š</div>
                    <h2 class="empty-title">No Data Available</h2>
                    <p class="empty-description">
                        Start by adding items to your wardrobe and generating outfits to see analytics here.
                    </p>
                </div>
            `;
        }

        function renderAnalytics(wardrobeItems, wornHistory, savedOutfits = [], calendarEvents = []) {
            const content = `
                <div class="stats-row">
                    ${renderTopStats(wardrobeItems, wornHistory, savedOutfits)}
                </div>
                
                <div class="dashboard-grid">
                    <div class="left-column">
                        ${renderMainChart(wornHistory)}
                        ${renderInsights(wardrobeItems, wornHistory, savedOutfits)}
                    </div>
                    <div class="right-column">
                        ${renderSideStats(wardrobeItems, wornHistory, calendarEvents)}
                        ${renderRecommendations(wardrobeItems, wornHistory)}
                    </div>
                </div>
            `;
            
            document.getElementById('analyticsContent').innerHTML = content;
            
            // Initialize charts after content is rendered
            setTimeout(() => {
                initializeMainChart(wornHistory);
                initializeSideChart(wornHistory);
            }, 100);
        }

        function renderTopStats(wardrobeItems, wornHistory, savedOutfits = []) {
            const totalItems = wardrobeItems.length;
            const usedItems = new Set();
            wornHistory.forEach(entry => {
                if (entry.outfit) {
                    entry.outfit.forEach(item => usedItems.add(item.name));
                }
            });
            
            const utilizationRate = totalItems > 0 ? Math.round((usedItems.size / totalItems) * 100) : 0;
            const avgScore = wornHistory.length > 0 ? 
                Math.round(wornHistory.reduce((sum, entry) => sum + (entry.score || 85), 0) / wornHistory.length) : 0;
            
            const activeDays = new Set(wornHistory.map(entry => entry.date)).size;
            const totalSavedOutfits = savedOutfits.length;
            
            return `
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-title">Total Items</div>
                        <div class="metric-icon blue">
                            <i class="fas fa-tshirt"></i>
                        </div>
                    </div>
                    <div class="metric-value">${totalItems}</div>
                    <div class="metric-change positive">
                        <i class="fas fa-arrow-up change-icon"></i>
                        ${totalItems > 0 ? 'Active' : 'Empty'}
                    </div>
                </div>

                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-title">Utilization</div>
                        <div class="metric-icon green">
                            <i class="fas fa-percentage"></i>
                        </div>
                    </div>
                    <div class="metric-value">${utilizationRate}%</div>
                    <div class="metric-change ${utilizationRate > 70 ? 'positive' : utilizationRate > 40 ? 'neutral' : 'negative'}">
                        <i class="fas fa-${utilizationRate > 70 ? 'arrow-up' : utilizationRate > 40 ? 'minus' : 'arrow-down'} change-icon"></i>
                        ${utilizationRate > 70 ? 'Excellent' : utilizationRate > 40 ? 'Good' : 'Low'}
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${utilizationRate}%"></div>
                    </div>
                </div>

                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-title">Avg Score</div>
                        <div class="metric-icon purple">
                            <i class="fas fa-star"></i>
                        </div>
                    </div>
                    <div class="metric-value">${avgScore}%</div>
                    <div class="metric-change ${avgScore > 85 ? 'positive' : avgScore > 70 ? 'neutral' : 'negative'}">
                        <i class="fas fa-${avgScore > 85 ? 'arrow-up' : avgScore > 70 ? 'minus' : 'arrow-down'} change-icon"></i>
                        ${avgScore > 85 ? 'Great' : avgScore > 70 ? 'Good' : 'Improve'}
                    </div>
                </div>

                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-title">Active Days</div>
                        <div class="metric-icon orange">
                            <i class="fas fa-calendar"></i>
                        </div>
                    </div>
                    <div class="metric-value">${activeDays}</div>
                    <div class="metric-change positive">
                        <i class="fas fa-arrow-up change-icon"></i>
                        ${activeDays > 0 ? 'Active' : 'None'}
                    </div>
                </div>

                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-title">Saved Outfits</div>
                        <div class="metric-icon pink">
                            <i class="fas fa-heart"></i>
                        </div>
                    </div>
                    <div class="metric-value">${totalSavedOutfits}</div>
                    <div class="metric-change ${totalSavedOutfits > 0 ? 'positive' : 'neutral'}">
                        <i class="fas fa-${totalSavedOutfits > 0 ? 'heart' : 'heart-o'} change-icon"></i>
                        ${totalSavedOutfits > 0 ? 'Saved' : 'None'}
                    </div>
                </div>
            `;
        }

        function renderMainChart(wornHistory) {
            if (wornHistory.length === 0) {
                return `
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">Usage Trends</h3>
                            <p class="chart-subtitle">Daily outfit generation</p>
                        </div>
                        <div class="empty-state">
                            <div class="empty-icon">ðŸ“ˆ</div>
                            <h3 class="empty-title">No Data</h3>
                            <p class="empty-description">Generate outfits to see trends</p>
                        </div>
                    </div>
                `;
            }
            
            return `
                <div class="chart-card">
                    <div class="chart-header">
                        <h3 class="chart-title">Usage Trends</h3>
                        <p class="chart-subtitle">Daily outfit generation over the last 90 days</p>
                    </div>
                    <div class="chart-container large">
                        <canvas id="mainChart"></canvas>
                    </div>
                </div>
            `;
        }

        function renderSideStats(wardrobeItems, wornHistory, calendarEvents = []) {
            const categories = {};
            wardrobeItems.forEach(item => {
                categories[item.category] = (categories[item.category] || 0) + 1;
            });
            
            const dominantCategory = Object.entries(categories).sort((a, b) => b[1] - a[1])[0];
            const colors = {};
            wardrobeItems.forEach(item => {
                if (item.color) {
                    colors[item.color] = (colors[item.color] || 0) + 1;
                }
            });
            
            const dominantColor = Object.entries(colors).sort((a, b) => b[1] - a[1])[0];
            
            return `
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-title">Top Category</div>
                        <div class="metric-icon blue">
                            <i class="fas fa-layer-group"></i>
                        </div>
                    </div>
                    <div class="metric-value">${dominantCategory ? dominantCategory[0] : 'N/A'}</div>
                    <div class="metric-change neutral">
                        <i class="fas fa-minus change-icon"></i>
                        ${dominantCategory ? dominantCategory[1] + ' items' : 'No data'}
                    </div>
                </div>

                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-title">Favorite Color</div>
                        <div class="metric-icon purple">
                            <i class="fas fa-palette"></i>
                        </div>
                    </div>
                    <div class="metric-value">${dominantColor ? dominantColor[0] : 'Mixed'}</div>
                    <div class="metric-change neutral">
                        <i class="fas fa-minus change-icon"></i>
                        ${dominantColor ? dominantColor[1] + ' items' : 'Varied'}
                    </div>
                </div>

                <div class="chart-card">
                    <div class="chart-header">
                        <h3 class="chart-title">Category Distribution</h3>
                        <p class="chart-subtitle">Item breakdown by type</p>
                    </div>
                    <div class="chart-container">
                        <canvas id="sideChart"></canvas>
                    </div>
                </div>
            `;
        }

        function renderInsights(wardrobeItems, wornHistory, savedOutfits = []) {
            const insights = generateInsights(wardrobeItems, wornHistory, savedOutfits);
            
            return `
                <div class="insights-card">
                    <div class="chart-header">
                        <h3 class="chart-title">Key Insights</h3>
                        <p class="chart-subtitle">AI-powered analysis</p>
                    </div>
                    ${insights.map(insight => `
                        <div class="insight-item">
                            <div class="insight-icon ${insight.type}">
                                <i class="fas ${insight.icon}"></i>
                            </div>
                            <div class="insight-content">
                                <div class="insight-title">${insight.title}</div>
                                <div class="insight-description">${insight.description}</div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function renderRecommendations(wardrobeItems, wornHistory) {
            const recommendations = generateRecommendations(wardrobeItems, wornHistory);
            
            return `
                <div class="recommendations-card">
                    <div class="chart-header">
                        <h3 class="chart-title">Recommendations</h3>
                        <p class="chart-subtitle">Optimize your wardrobe</p>
                    </div>
                    ${recommendations.map(rec => `
                        <div class="recommendation-item">
                            <div class="rec-title">${rec.title}</div>
                            <div class="rec-description">${rec.description}</div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function initializeMainChart(wornHistory) {
            const ctx = document.getElementById('mainChart');
            if (!ctx) return;
            
            const labels = [];
            const data = [];
            
            // Generate 90 days of data to show long-term usage
            for (let i = 89; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                labels.push(date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));
                
                // If we have real data, use it, otherwise generate realistic patterns
                let dayOutfits = 0;
                if (wornHistory.length > 0) {
                    dayOutfits = wornHistory.filter(entry => {
                        const entryDate = new Date(entry.date);
                        return entryDate.toDateString() === date.toDateString();
                    }).length;
                } else {
                    // Generate realistic usage patterns
                    const dayOfWeek = date.getDay();
                    const isWeekend = dayOfWeek === 0 || dayOfWeek === 6;
                    
                    // More activity on weekdays, some on weekends
                    if (isWeekend) {
                        dayOutfits = Math.random() > 0.7 ? Math.floor(Math.random() * 3) + 1 : 0;
                    } else {
                        dayOutfits = Math.random() > 0.3 ? Math.floor(Math.random() * 4) + 1 : 0;
                    }
                    
                    // Add some variation and trends
                    const trendFactor = Math.sin(i / 10) * 0.5 + 0.5;
                    dayOutfits = Math.floor(dayOutfits * trendFactor);
                }
                
                data.push(dayOutfits);
            }
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Daily Outfits',
                        data: data,
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#3b82f6',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: '#94a3b8',
                                font: {
                                    size: 11
                                }
                            }
                        },
                        y: {
                            grid: {
                                color: '#334155'
                            },
                            ticks: {
                                color: '#94a3b8',
                                font: {
                                    size: 11
                                }
                            }
                        }
                    }
                }
            });
        }

        function initializeSideChart(wornHistory) {
            const ctx = document.getElementById('sideChart');
            if (!ctx) return;
            
            const wardrobeItems = JSON.parse(localStorage.getItem('wardrobeItems') || '[]');
            const categories = {};
            wardrobeItems.forEach(item => {
                categories[item.category] = (categories[item.category] || 0) + 1;
            });
            
            const labels = Object.keys(categories);
            const data = Object.values(categories);
            const colors = ['#3b82f6', '#10b981', '#8b5cf6', '#f59e0b', '#ef4444'];
            
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: colors.slice(0, labels.length),
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#64748b',
                                font: {
                                    size: 11
                                },
                                padding: 15
                            }
                        }
                    }
                }
            });
        }

        function generateInsights(wardrobeItems, wornHistory, savedOutfits = []) {
            const insights = [];
            
            // Color analysis
            const colors = {};
            wardrobeItems.forEach(item => {
                if (item.color) {
                    colors[item.color] = (colors[item.color] || 0) + 1;
                }
            });
            
            const dominantColor = Object.entries(colors).sort((a, b) => b[1] - a[1])[0];
            if (dominantColor) {
                insights.push({
                    type: 'info',
                    icon: 'fa-palette',
                    title: 'Color Preference',
                    description: `${dominantColor[0]} is your dominant color with ${dominantColor[1]} items`
                });
            }
            
            // Usage analysis
            const usedItems = new Set();
            wornHistory.forEach(entry => {
                entry.outfit.forEach(item => usedItems.add(item.name));
            });
            
            const utilizationRate = Math.round((usedItems.size / wardrobeItems.length) * 100);
            insights.push({
                type: utilizationRate > 70 ? 'success' : 'warning',
                icon: 'fa-chart-line',
                title: 'Wardrobe Usage',
                description: `${utilizationRate}% of your items have been used in outfits`
            });
            
            // Category analysis
            const categories = {};
            wardrobeItems.forEach(item => {
                categories[item.category] = (categories[item.category] || 0) + 1;
            });
            
            const dominantCategory = Object.entries(categories).sort((a, b) => b[1] - a[1])[0];
            if (dominantCategory) {
                insights.push({
                    type: 'success',
                    icon: 'fa-layer-group',
                    title: 'Category Focus',
                    description: `You have ${dominantCategory[1]} ${dominantCategory[0]} items`
                });
            }
            
            return insights;
        }

        function generateRecommendations(wardrobeItems, wornHistory) {
            const recommendations = [];
            
            // Check utilization
            const usedItems = new Set();
            wornHistory.forEach(entry => {
                entry.outfit.forEach(item => usedItems.add(item.name));
            });
            
            const unusedItems = wardrobeItems.filter(item => !usedItems.has(item.name));
            
            if (unusedItems.length > wardrobeItems.length * 0.3) {
                recommendations.push({
                    title: "Rotate Unused Items",
                    description: `You have ${unusedItems.length} items that haven't been worn recently.`
                });
            }
            
            // Check category balance
            const categories = {};
            wardrobeItems.forEach(item => {
                categories[item.category] = (categories[item.category] || 0) + 1;
            });
            
            const categoryCounts = Object.values(categories);
            const maxCategory = Math.max(...categoryCounts);
            const minCategory = Math.min(...categoryCounts);
            
            if (maxCategory - minCategory > 3) {
                recommendations.push({
                    title: "Balance Categories",
                    description: "Consider adding more items to underrepresented categories."
                });
            }
            
            if (recommendations.length === 0) {
                recommendations.push({
                    title: "Great Job!",
                    description: "Your wardrobe is well-balanced and you're using items effectively."
                });
            }
            
            return recommendations;
        }
    </script>
    <script src="script.js"></script>
</body>
</html>